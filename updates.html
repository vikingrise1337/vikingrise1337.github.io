<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">

    <title>Viking Rise Update Notes</title>

    <meta name="theme-color" content="#d4af37">
    <meta property="og:title" content="Viking Rise Patch Notes">
    <meta property="og:description" content="Latest Updates & News / Aktuelle Updates & News">
    <meta property="og:image" content="https://vikingrise1337.github.io/favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="favicon.png">

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
    <script async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8083367890134296"
            crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Roboto:wght@300;400;500&display=swap');

        @font-face {
            font-family: 'CinzelRus';
            src: url('CinzelRus.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body { font-family: 'Roboto', sans-serif; background-color: #0b101b; }

        .viking-font { font-family: 'Cinzel', serif; }

        :lang(ru) .viking-font {
            font-family: 'CinzelRus', 'Times New Roman', serif;
            letter-spacing: 0.05em;
        }

        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); }
        .gold-text { color: #d4af37; }

        ul.detail-list { list-style: none; padding: 0; margin: 0; }
        ul.detail-list li { position: relative; padding-left: 24px; margin-bottom: 8px; font-size: 0.9rem; color: #cbd5e1; line-height: 1.5; }
        ul.detail-list li::before { content: "•"; position: absolute; left: 8px; color: #64748b; font-weight: bold; }

        details { margin-bottom: 10px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; overflow: hidden; transition: all 0.3s ease; }
        details[open] { border-color: #d4af37; background: rgba(0, 0, 0, 0.3); }
        details > summary { list-style: none; padding: 15px; background: rgba(255, 255, 255, 0.05); cursor: pointer; font-weight: bold; color: #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        details > summary::-webkit-details-marker { display: none; }
        .dropdown-content { padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #94a3b8; font-size: 0.9rem; line-height: 1.6; }

        @media (max-width: 768px) {
            .header-mobile-fix { height: auto !important; min-height: 24rem; padding-bottom: 5rem !important; }
            h1 { font-size: 2rem !important; }
            .dropdown-wrapper { margin-top: 1rem !important; width: 100%; }
            #local-time-display { font-size: 1.1rem !important; white-space: nowrap; }
        }

        .lang-btn { cursor: pointer; font-size: 0.75rem; transition: color 0.3s; }
        .lang-active { color: #d4af37; font-weight: bold; }
        .lang-inactive { color: #64748b; }
        .lang-inactive:hover { color: white; }
    </style>
</head>

<body class="min-h-screen pb-20 text-gray-200">

<nav class="w-full z-50 border-b border-white/10 bg-[#0b101b]">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <a href="index.html" id="nav-home-link" class="flex items-center gap-2 hover:opacity-80 transition">
            <span class="material-symbols-outlined text-gray-400 notranslate">arrow_back</span>
            <span class="viking-font text-lg font-bold text-white"><span id="txt-back">Back to</span>
                <span class="text-[#d4af37]" id="txt-home">Home</span></span>
        </a>

        <div class="flex items-center">
            <div class="hidden sm:flex items-center mr-4 pr-4 border-r border-white/20">
                <span id="nav-clock" class="text-sm font-mono text-[#d4af37] font-bold">--:--:--</span>
            </div>

            <div class="flex items-center gap-3">
                <a href="?lang=en" class="lang-btn" id="lang-en">EN</a>
                <span class="text-white/20">|</span>
                <a href="?lang=de" class="lang-btn" id="lang-de">DE</a>
                <span class="text-white/20">|</span>
                <a href="?lang=cn" class="lang-btn" id="lang-cn">CN</a>
                <span class="text-white/20">|</span>
                <a href="?lang=ru" class="lang-btn" id="lang-ru">RU</a>
            </div>
        </div>
    </div>
</nav>

<div class="header-mobile-fix relative w-full h-80 md:h-96 overflow-hidden border-b-4 border-[#d4af37] mb-12">
    <!-- WICHTIG: id für dynamisches Setzen -->
    <img id="hero-img" src="header-bg.jpg" alt="Viking Update Hero"
         class="absolute inset-0 w-full h-full object-cover opacity-80" style="object-position: center top;">
    <div class="absolute inset-0 bg-gradient-to-t from-[#0b101b] via-transparent to-transparent"></div>

    <div class="absolute bottom-0 left-0 p-6 md:p-12 w-full flex flex-col items-start justify-end h-full">
        <span id="txt-badge"
              class="inline-block px-3 py-1 mb-2 text-xs font-bold tracking-wider text-black bg-[#d4af37] rounded uppercase">Update Archive</span>
        <h1 id="txt-title"
            class="text-4xl md:text-6xl font-bold text-white drop-shadow-lg mb-2 viking-font">Patch Notes</h1>

        <div class="dropdown-wrapper mt-4 relative inline-block w-full md:w-auto">
            <select id="version-select" onchange="changeVersion(this.value)"
                    class="appearance-none bg-black/60 border border-[#d4af37] text-white py-2 px-4 pr-10 rounded leading-tight focus:outline-none focus:bg-black/80 focus:border-white cursor-pointer hover:bg-black/70 transition w-full md:w-auto backdrop-blur-sm">
                <option>Loading...</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-[#d4af37]">
                <svg class="fill-current h-4 w-4" viewBox="0 0 20 20">
                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                </svg>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 -mt-10 relative z-10">
    <div class="glass-panel rounded-xl p-6 mb-8 border border-gray-700 flex flex-col md:flex-row items-center justify-between gap-4 shadow-xl">
        <div class="flex items-center gap-4">
            <span class="material-symbols-outlined text-4xl gold-text notranslate">schedule</span>
            <div>
                <h2 id="txt-utc" class="text-lg font-bold text-white">Maintenance (UTC)</h2>
                <p id="utc-time-display" class="text-sm text-gray-400">--</p>
            </div>
        </div>

        <div class="text-center md:text-right bg-black/30 p-3 rounded-lg border border-gray-700 w-full md:w-auto">
            <p id="txt-local" class="text-xs text-gray-400 uppercase tracking-widest mb-1">Start Time (Local)</p>
            <p id="local-time-display" class="text-xl font-mono text-[#d4af37] font-bold">--:--</p>
        </div>
    </div>

    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
        <div class="flex gap-2 bg-[#1e293b] p-1 rounded-lg border border-gray-700">
            <button id="btn-all" onclick="filterContent('all')"
                    class="px-4 py-2 rounded-md text-sm font-bold bg-[#d4af37] text-black transition-colors">All</button>
            <button id="btn-major" onclick="filterContent('major')"
                    class="px-4 py-2 rounded-md text-sm font-bold text-gray-400 hover:text-white transition-colors">Highlights</button>
            <button id="btn-opt" onclick="filterContent('opt')"
                    class="px-4 py-2 rounded-md text-sm font-bold text-gray-400 hover:text-white transition-colors">Details</button>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div id="major-updates-section" class="lg:col-span-2 space-y-8"></div>

        <div id="details-section" class="lg:col-span-1 space-y-6">
            <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                <h3 class="text-xl font-bold text-[#d4af37] mb-4 flex items-center gap-2 viking-font">
                    <span class="material-symbols-outlined notranslate">radio_button_unchecked</span>
                    <span id="txt-cat-new">New</span>
                </h3>
                <ul class="detail-list" id="list-new"></ul>
            </div>

            <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                <h3 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2 viking-font">
                    <span class="material-symbols-outlined notranslate">tune</span>
                    <span id="txt-cat-opt">Optimizations</span>
                </h3>
                <div id="opt-container" class="space-y-2"></div>
            </div>

            <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                <h3 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2 viking-font">
                    <span class="material-symbols-outlined notranslate">pest_control</span>
                    <span id="txt-cat-fix">Fixes</span>
                </h3>
                <ul class="detail-list" id="list-fixes"></ul>
            </div>

            <div class="glass-panel p-4 rounded-xl border border-gray-700 flex flex-col items-center mt-6">
                <span class="text-[10px] uppercase tracking-widest text-gray-500 mb-2 w-full text-left">Advertisement</span>
                <ins class="adsbygoogle" style="display:block; width: 100%;"
                     data-ad-client="ca-pub-8083367890134296"
                     data-ad-slot="5743006522"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </div>
    </div>

    <div class="text-center mt-12 mb-4 text-gray-600 text-xs">Unofficial Patch Notes Page</div>
</div>

<script>
    const uiTranslations = {
        en: {
            back: "Back to", home: "Home", badge: "Update Archive", title: "Patch Notes",
            utc: "Maintenance (UTC)", local: "Start Time (Local)",
            all: "All", major: "Highlights", opt: "Details",
            cat_new: "New Features", cat_opt: "Optimizations", cat_fix: "Fixes",
            loading: "Loading Versions..."
        },
        de: {
            back: "Zurück zur", home: "Startseite", badge: "Update Archiv", title: "Patch Notes",
            utc: "Wartung (UTC)", local: "Startzeit (Lokal)",
            all: "Alle", major: "Highlights", opt: "Details",
            cat_new: "Neuheiten", cat_opt: "Optimierungen", cat_fix: "Fehlerbehebungen",
            loading: "Lade Versionen..."
        },
        cn: {
            back: "返回", home: "主页", badge: "更新存档", title: "更新说明",
            utc: "维护时间 (UTC)", local: "开始时间 (本地)",
            all: "全部", major: "亮点", opt: "详情",
            cat_new: "新功能", cat_opt: "优化", cat_fix: "修复",
            loading: "加载版本..."
        },
        ru: {
            back: "Назад на", home: "Главную", badge: "Архив обновлений", title: "Патчноуты",
            utc: "Тех. работы (UTC)", local: "Начало (Местное)",
            all: "Все", major: "Главное", opt: "Детали",
            cat_new: "Новое", cat_opt: "Оптимизация", cat_fix: "Исправления",
            loading: "Загрузка..."
        }
    };

    const urlParams = new URLSearchParams(window.location.search);
    let currentLang = urlParams.get('lang');
    const validLangs = ['en', 'de', 'cn', 'ru'];

    if (!validLangs.includes(currentLang)) {
        const browserLang = navigator.language || navigator.userLanguage;
        if (browserLang.startsWith('de')) currentLang = 'de';
        else if (browserLang.startsWith('zh')) currentLang = 'cn';
        else if (browserLang.startsWith('ru')) currentLang = 'ru';
        else currentLang = 'en';
    }

    let allPatchData = [];

    function startLiveClock() {
        const clockEl = document.getElementById('nav-clock');
        if (!clockEl) return;

        function tick() {
            const now = new Date();
            clockEl.innerText = now.toLocaleTimeString(currentLang === 'cn' ? 'zh-CN' : currentLang, {
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }

        tick();
        setInterval(tick, 1000);
    }

    function updateUI() {
        const t = uiTranslations[currentLang];
        document.getElementById('txt-back').innerText = t.back;
        document.getElementById('txt-home').innerText = t.home;
        document.getElementById('txt-badge').innerText = t.badge;
        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('txt-utc').innerText = t.utc;
        document.getElementById('txt-local').innerText = t.local;
        document.getElementById('btn-all').innerText = t.all;
        document.getElementById('btn-major').innerText = t.major;
        document.getElementById('btn-opt').innerText = t.opt;
        document.getElementById('txt-cat-new').innerText = t.cat_new;
        document.getElementById('txt-cat-opt').innerText = t.cat_opt;
        document.getElementById('txt-cat-fix').innerText = t.cat_fix;

        document.documentElement.lang = currentLang;

        validLangs.forEach(l => {
            const btn = document.getElementById(`lang-${l}`);
            btn.className = l === currentLang ? "lang-btn lang-active" : "lang-btn lang-inactive";
        });

        const homeLink = document.getElementById('nav-home-link');
        homeLink.href = `index.html?lang=${currentLang}`;
    }

    function isNonEmptyString(value) {
        return typeof value === "string" && value.trim() !== "";
    }

    function toAbsoluteUrlMaybe(path) {
        const p = (typeof path === "string") ? path.trim() : "";
        if (!p) return null;

        if (/^(https?:)?\/\//i.test(p) || p.startsWith("data:") || p.startsWith("blob:")) {
            return p;
        }

        if (p.startsWith("/")) {
            return new URL(p, window.location.origin).href;
        }

        return new URL(p, window.location.href).href;
    }

    function buildImageCandidates(rawUrl, fallbackFiles) {
        const candidates = [];
        const prefixes = ["", "./", "images/", "assets/", "img/"];

        if (isNonEmptyString(rawUrl)) {
            const url = rawUrl.trim();

            if (/^(https?:)?\/\//i.test(url) || url.startsWith("data:") || url.startsWith("blob:") || url.startsWith("/")) {
                const abs = toAbsoluteUrlMaybe(url);
                if (abs) candidates.push(abs);
            } else {
                prefixes.forEach(prefix => {
                    const abs = toAbsoluteUrlMaybe(prefix + url);
                    if (abs) candidates.push(abs);
                });
            }
        }

        if (Array.isArray(fallbackFiles)) {
            fallbackFiles.forEach(file => {
                if (!isNonEmptyString(file)) return;
                prefixes.forEach(prefix => {
                    const abs = toAbsoluteUrlMaybe(prefix + file.trim());
                    if (abs) candidates.push(abs);
                });
            });
        }

        return [...new Set(candidates)];
    }

    function setImgWithFallback(imgEl, candidates) {
        const list = Array.isArray(candidates) ? candidates.filter(Boolean) : [];
        if (!imgEl || list.length === 0) return;

        let i = 0;

        function tryNext() {
            if (i >= list.length) return;
            imgEl.src = list[i];
            i += 1;
        }

        imgEl.onerror = () => {
            tryNext();
        };

        tryNext();
    }

    function parseTimestamp(ts) {
        if (ts === null || ts === undefined) return null;

        if (typeof ts === "number" && Number.isFinite(ts)) {
            const ms = ts < 1e12 ? ts * 1000 : ts;
            return new Date(ms);
        }

        if (typeof ts === "string") {
            const s = ts.trim();
            if (!s) return null;

            const num = Number(s);
            if (!Number.isNaN(num) && Number.isFinite(num)) {
                const ms = num < 1e12 ? num * 1000 : num;
                return new Date(ms);
            }

            const d = new Date(s);
            return Number.isNaN(d.getTime()) ? null : d;
        }

        return null;
    }

    async function init() {
        startLiveClock();
        updateUI();

        try {
            const response = await fetch('patchnotes.json?v=' + new Date().getTime());
            allPatchData = await response.json();

            const selector = document.getElementById('version-select');
            selector.innerHTML = '';

            allPatchData.forEach((update, index) => {
                const option = document.createElement('option');
                option.value = index;
                const titleKey = `title_${currentLang}`;
                option.text = update.meta[titleKey] || update.meta.title_en || `Update #${index + 1}`;
                selector.appendChild(option);
            });

            loadUpdate(0);
        } catch (error) {
            console.error("Error:", error);
        }
    }

    function loadUpdate(index) {
        const update = allPatchData[index];
        if (!update) return;

        const data = update[currentLang] || update['en'];
        if (!data) return;

        const meta = update.meta || {};

        // --- HERO IMAGE OBEN (Update-spezifisch + Fallback-Kette) ---
        const heroImgEl = document.getElementById("hero-img");
        const heroRaw = isNonEmptyString(meta.image_url) ? meta.image_url.trim() : "";
        setImgWithFallback(heroImgEl, buildImageCandidates(heroRaw, ["header-bg.jpg"]));

        const fillList = (id, items) => {
            const el = document.getElementById(id);
            if (el) el.innerHTML = (items && Array.isArray(items)) ? items.map(i => `<li>${i}</li>`).join('') : '';
        };
        fillList('list-new', data.new_features);
        fillList('list-fixes', data.fixes);

        const majorContainer = document.getElementById('major-updates-section');
        if (majorContainer) {
            majorContainer.innerHTML = '';

            const fallbackImages = ["surtr.jpg", "dragon.jpg", "christmas.jpg"];
            const heroImage = isNonEmptyString(meta.image_url) ? meta.image_url.trim() : "";

            if (data.major && Array.isArray(data.major)) {
                data.major.forEach((text, i) => {
                    const rawImg = (i === 0 && heroImage) ? heroImage : fallbackImages[i % fallbackImages.length];

                    const cardEl = document.createElement("div");
                    cardEl.className = "glass-panel rounded-xl overflow-hidden shadow-lg border border-gray-700 group hover:border-[#d4af37] transition-all duration-300 filter-item major";

                    cardEl.innerHTML = `
                        <div class="relative h-64 overflow-hidden">
                            <img alt="Highlight image" loading="lazy"
                                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                            <div class="absolute inset-0 bg-gradient-to-t from-[#0b101b] to-transparent"></div>
                            <h3 class="absolute bottom-4 left-4 text-xl font-bold text-white drop-shadow-lg viking-font">
                                ${i === 0 && heroImage ? 'Main Feature' : `Highlight #${i + 1}`}
                            </h3>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-300 leading-relaxed">${text}</p>
                        </div>
                    `;

                    const imgEl = cardEl.querySelector("img");
                    setImgWithFallback(imgEl, buildImageCandidates(rawImg, ["header-bg.jpg"]));

                    majorContainer.appendChild(cardEl);
                });
            }
        }

        const optContainer = document.getElementById('opt-container');
        if (optContainer) {
            optContainer.innerHTML = '';
            if (data.optimizations && Array.isArray(data.optimizations)) {
                data.optimizations.forEach(opt => {
                    if (opt.title && opt.items) {
                        const details = document.createElement('details');

                        const summary = document.createElement('summary');
                        summary.innerHTML = `${opt.title} <span class="material-symbols-outlined notranslate text-sm">expand_more</span>`;

                        const contentDiv = document.createElement('div');
                        contentDiv.className = "dropdown-content";

                        const ul = document.createElement('ul');
                        ul.className = "detail-list";

                        opt.items.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            ul.appendChild(li);
                        });

                        contentDiv.appendChild(ul);
                        details.appendChild(summary);
                        details.appendChild(contentDiv);
                        optContainer.appendChild(details);
                    }
                });
            }
        }

        document.getElementById('utc-time-display').innerText = meta.display_time || "--";

        const dt = parseTimestamp(meta.start_timestamp);
        if (dt) {
            const loc = (currentLang === 'cn') ? 'zh-CN' : currentLang;
            const localStr = dt.toLocaleString(loc, { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            const offset = -(dt.getTimezoneOffset() / 60);
            const offsetStr = offset >= 0 ? `+${offset}` : offset;
            document.getElementById('local-time-display').innerHTML =
                `${localStr} <span class="text-sm font-normal text-gray-500">(UTC${offsetStr})</span>`;
        } else {
            document.getElementById('local-time-display').innerText = "--";
        }
    }

    function changeVersion(index) { loadUpdate(index); }

    function filterContent(type) {
        const btns = ['all', 'major', 'opt'];
        const leftCol = document.getElementById('major-updates-section');
        const rightCol = document.getElementById('details-section');
        const mainGrid = document.querySelector('.grid');

        btns.forEach(btn => {
            const el = document.getElementById(`btn-${btn}`);
            if (btn === type) {
                el.classList.remove('text-gray-400', 'hover:text-white');
                el.classList.add('bg-[#d4af37]', 'text-black');
            } else {
                el.classList.add('text-gray-400', 'hover:text-white');
                el.classList.remove('bg-[#d4af37]', 'text-black');
            }
        });

        if (type === 'all') {
            leftCol.style.display = 'block';
            rightCol.style.display = 'block';
            mainGrid.classList.add('lg:grid-cols-3');
            mainGrid.classList.remove('grid-cols-1');
            leftCol.className = 'lg:col-span-2 space-y-8';
            rightCol.className = 'lg:col-span-1 space-y-6';
        } else if (type === 'major') {
            leftCol.style.display = 'block';
            rightCol.style.display = 'none';
            mainGrid.classList.remove('lg:grid-cols-3');
            mainGrid.classList.add('grid-cols-1');
            leftCol.className = 'space-y-8 mx-auto max-w-3xl';
        } else if (type === 'opt') {
            leftCol.style.display = 'none';
            rightCol.style.display = 'block';
            mainGrid.classList.remove('lg:grid-cols-3');
            mainGrid.classList.add('grid-cols-1');
            rightCol.className = 'space-y-6 mx-auto max-w-2xl';
        }
    }

    init();
</script>
</body>
</html>
