<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viking Rise Update Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8083367890134296" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Roboto:wght@300;400;500&display=swap');
        body { font-family: 'Roboto', sans-serif; background-color: #0b101b; }
        .viking-font { font-family: 'Cinzel', serif; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); }
        .gold-text { color: #d4af37; }
        ul.detail-list { list-style: none; padding: 0; margin: 0; }
        ul.detail-list li { position: relative; padding-left: 24px; margin-bottom: 8px; font-size: 0.9rem; color: #cbd5e1; line-height: 1.5; }
        ul.detail-list li::before { content: "•"; position: absolute; left: 8px; color: #64748b; font-weight: bold; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d4af37; }
        .lang-active { color: #d4af37; font-weight: bold; }
        .lang-inactive { color: #64748b; }
        .lang-inactive:hover { color: white; }
    </style>
</head>
<body class="min-h-screen pb-20 text-gray-200">

    <nav class="w-full z-50 border-b border-white/10 bg-[#0b101b]">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition">
                <span class="material-symbols-outlined text-gray-400">arrow_back</span>
                <span class="viking-font text-lg font-bold text-white">Zurück zur <span class="text-[#d4af37]">Startseite</span></span>
            </a>
            <div class="flex items-center gap-2">
                <a href="updates.html" class="text-xs lang-active">DE</a>
                <span class="text-xs text-white/20">|</span>
                <a href="updates_en.html" class="text-xs lang-inactive transition-colors">EN</a>
            </div>
        </div>
    </nav>

    <div class="relative w-full h-80 md:h-96 overflow-hidden border-b-4 border-[#d4af37]">
        <img src="header-bg.jpg" alt="Viking Update Hero" class="absolute inset-0 w-full h-full object-cover opacity-80" style="object-position: center top;">
        <div class="absolute inset-0 bg-gradient-to-t from-[#0b101b] via-transparent to-transparent"></div>
        <div class="absolute bottom-0 left-0 p-6 md:p-12 w-full text-center md:text-left">
            <span class="inline-block px-3 py-1 mb-2 text-xs font-bold tracking-wider text-black bg-[#d4af37] rounded uppercase">Patch Notes</span>
            <h1 class="text-4xl md:text-6xl font-bold text-white drop-shadow-lg mb-2 viking-font">Update Archiv</h1>
            
            <div class="mt-4 relative inline-block">
                <select id="version-select" onchange="changeVersion(this.value)" class="appearance-none bg-black/50 border border-[#d4af37] text-white py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-black/70 focus:border-white cursor-pointer hover:bg-black/70 transition">
                    <option>Lade Versionen...</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-[#d4af37]">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 -mt-10 relative z-10">
        <div class="glass-panel rounded-xl p-6 mb-8 border border-gray-700 flex flex-col md:flex-row items-center justify-between gap-4 shadow-xl">
            <div class="flex items-center gap-4">
                <span class="material-symbols-outlined text-4xl gold-text">schedule</span>
                <div>
                    <h2 class="text-lg font-bold text-white">Wartungszeitraum (UTC)</h2>
                    <p id="utc-time-display" class="text-sm text-gray-400">--</p>
                </div>
            </div>
            <div class="text-center md:text-right bg-black/30 p-3 rounded-lg border border-gray-700 w-full md:w-auto">
                <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Deine Ortszeit</p>
                <p id="local-time-display" class="text-xl font-mono text-[#d4af37] font-bold">--:--</p>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
            <div class="flex gap-2 bg-[#1e293b] p-1 rounded-lg border border-gray-700">
                <button id="btn-all" onclick="filterContent('all')" class="px-4 py-2 rounded-md text-sm font-bold bg-[#d4af37] text-black transition-colors">Alle</button>
                <button id="btn-major" onclick="filterContent('major')" class="px-4 py-2 rounded-md text-sm font-bold text-gray-400 hover:text-white transition-colors">Highlights</button>
                <button id="btn-opt" onclick="filterContent('opt')" class="px-4 py-2 rounded-md text-sm font-bold text-gray-400 hover:text-white transition-colors">Details</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div id="major-updates-section" class="lg:col-span-2 space-y-8">
                <div class="glass-panel rounded-xl border border-gray-700 p-6">
                    <h3 class="text-2xl font-bold text-white mb-4 viking-font border-b border-gray-700 pb-2">⚔️ Highlights</h3>
                    <ul class="detail-list space-y-4" id="list-major">
                        </ul>
                 </div>
            </div>

            <div id="details-section" class="lg:col-span-1 space-y-6">
                <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                    <h3 class="text-xl font-bold text-[#d4af37] mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined">radio_button_unchecked</span> Neu
                    </h3>
                    <ul class="detail-list" id="list-new"></ul>
                </div>

                <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                    <h3 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined">tune</span> Optimierungen
                    </h3>
                    <ul class="detail-list" id="list-opt"></ul>
                </div>

                <div class="glass-panel p-5 rounded-xl border border-gray-700 filter-item opt">
                    <h3 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined">pest_control</span> Fehlerbehebungen
                    </h3>
                    <ul class="detail-list" id="list-fixes"></ul>
                </div>
                
                <div class="glass-panel p-4 rounded-xl border border-gray-700 flex flex-col items-center mt-6">
                    <span class="text-[10px] uppercase tracking-widest text-gray-500 mb-2 w-full text-left">Anzeige</span>
                    <ins class="adsbygoogle" style="display:block; width: 100%;" data-ad-client="ca-pub-8083367890134296" data-ad-slot="5743006522" data-ad-format="auto" data-full-width-responsive="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>
            </div>
        </div>
        <div class="text-center mt-12 mb-4 text-gray-600 text-xs">Unofficial Patch Notes Page</div>
    </div>

    <script>
        let allPatchData = [];

        async function init() {
            try {
                // Wir erwarten jetzt eine LISTE (Array) von Updates
                const response = await fetch('patchnotes.json');
                allPatchData = await response.json();
                
                if(!Array.isArray(allPatchData)) {
                     // Fallback falls Datei noch altes Format hat
                     console.warn("Altes JSON Format erkannt, konvertiere temporär.");
                     allPatchData = [ { meta: { title_de: "Aktuell", start_timestamp: new Date().toISOString() }, de: allPatchData.de || allPatchData } ];
                }

                // Dropdown füllen
                const selector = document.getElementById('version-select');
                selector.innerHTML = '';
                
                allPatchData.forEach((update, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    // Zeige Datum aus Meta, oder Fallback
                    option.text = update.meta?.title_de || `Update #${index+1}`;
                    selector.appendChild(option);
                });

                // Erstes Update laden (das neuste)
                loadUpdate(0);

            } catch (error) { console.error("Fehler:", error); }
        }

        function loadUpdate(index) {
            const update = allPatchData[index];
            if(!update) return;

            const data = update.de; // Sprache Deutsch
            const meta = update.meta;

            // 1. Listen füllen
            const fill = (id, items) => {
                const el = document.getElementById(id);
                if(el) el.innerHTML = items ? items.map(i => `<li>${i}</li>`).join('') : '';
            };

            fill('list-major', data.major);
            fill('list-new', data.new_features);
            fill('list-opt', data.optimizations);
            fill('list-fixes', data.fixes);

            // 2. Zeitberechnung (Fix für Ortszeit)
            document.getElementById('utc-time-display').innerText = meta.display_time || "Unbekannt";
            
            if (meta.start_timestamp) {
                const date = new Date(meta.start_timestamp);
                const options = { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                const localStr = date.toLocaleDateString(navigator.language, options);
                
                // Offset berechnen
                const offsetMinutes = date.getTimezoneOffset(); 
                const offsetHours = -(offsetMinutes / 60);
                const offsetStr = offsetHours >= 0 ? `+${offsetHours}` : offsetHours;
                
                document.getElementById('local-time-display').innerHTML = `${localStr} <span class="text-sm font-normal text-gray-500">(UTC${offsetStr})</span>`;
            } else {
                 document.getElementById('local-time-display').innerText = "--";
            }
        }

        function changeVersion(index) {
            loadUpdate(index);
        }
        
        // Filter Funktion (Bleibt gleich)
        function filterContent(type) {
             const btns = ['all', 'major', 'opt'];
             const leftCol = document.getElementById('major-updates-section');
             const rightCol = document.getElementById('details-section');
             const mainGrid = document.querySelector('.grid');
             btns.forEach(btn => {
                 const el = document.getElementById(`btn-${btn}`);
                 if(btn === type) { el.classList.remove('text-gray-400', 'hover:text-white'); el.classList.add('bg-[#d4af37]', 'text-black'); } 
                 else { el.classList.add('text-gray-400', 'hover:text-white'); el.classList.remove('bg-[#d4af37]', 'text-black'); }
             });
             if (type === 'all') { leftCol.style.display = 'block'; rightCol.style.display = 'block'; mainGrid.classList.add('lg:grid-cols-3'); mainGrid.classList.remove('grid-cols-1'); leftCol.className = 'lg:col-span-2 space-y-8'; rightCol.className = 'lg:col-span-1 space-y-6'; } 
             else if (type === 'major') { leftCol.style.display = 'block'; rightCol.style.display = 'none'; mainGrid.classList.remove('lg:grid-cols-3'); mainGrid.classList.add('grid-cols-1'); leftCol.className = 'space-y-8 mx-auto max-w-3xl'; } 
             else if (type === 'opt') { leftCol.style.display = 'none'; rightCol.style.display = 'block'; mainGrid.classList.remove('lg:grid-cols-3'); mainGrid.classList.add('grid-cols-1'); rightCol.className = 'space-y-6 mx-auto max-w-2xl'; }
        }

        init();
    </script>
</body>
</html>
