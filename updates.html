<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viking Rise Updates</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <style>
        /* FONTS */
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Roboto:wght@300;400;500&display=swap');
        @font-face { font-family: 'CinzelRus'; src: url('CinzelRus.ttf') format('truetype'); }
        
        body { font-family: 'Roboto', sans-serif; background-color: #0b101b; color: #e2e8f0; }
        
        .viking-font { font-family: 'Cinzel', serif; }
        :lang(ru) .viking-font { font-family: 'CinzelRus', serif; }
        
        .gold-text { color: #d4af37; }
        .glass-panel { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* LISTEN & DROPDOWNS */
        ul.detail-list li { position: relative; padding-left: 24px; margin-bottom: 8px; color: #cbd5e1; }
        ul.detail-list li::before { content: "•"; position: absolute; left: 8px; color: #64748b; font-weight: bold; }
        
        details { margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; }
        details[open] { border-color: #d4af37; background: rgba(0,0,0,0.3); }
        details > summary { padding: 15px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        details > summary:hover { background: rgba(255,255,255,0.05); }
        
        /* SPRACH BUTTONS */
        .lang-btn { cursor: pointer; font-size: 0.85rem; font-weight: bold; }
        .lang-active { color: #d4af37; text-decoration: underline; text-underline-offset: 4px; }
        .lang-inactive { color: #64748b; }
        
        /* TRANSITIONS */
        .transition-transform { transition: transform 0.3s ease; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <nav class="w-full z-50 border-b border-white/10 bg-[#0b101b]">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" id="nav-home-link" class="flex items-center gap-2 hover:opacity-80 transition">
                <span class="material-symbols-outlined text-gray-400 notranslate">arrow_back</span>
                <span class="viking-font text-lg font-bold text-white"><span id="txt-back">Back to</span> <span class="text-[#d4af37]" id="txt-home">Home</span></span>
            </a>
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex items-center mr-4 pr-4 border-r border-white/20">
                    <span id="nav-clock" class="text-sm font-mono text-[#d4af37] font-bold">--:--:--</span>
                </div>
                <div class="flex gap-3">
                    <a href="?lang=en" class="lang-btn" id="lang-en">EN</a> | <a href="?lang=de" class="lang-btn" id="lang-de">DE</a> | 
                    <a href="?lang=cn" class="lang-btn" id="lang-cn">CN</a> | <a href="?lang=ru" class="lang-btn" id="lang-ru">RU</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative w-full h-80 md:h-96 overflow-hidden border-b-4 border-[#d4af37] mb-12">
        <img src="header-bg.jpg" id="hero-img" class="absolute inset-0 w-full h-full object-cover opacity-80 transition-opacity duration-500">
        <div class="absolute inset-0 bg-gradient-to-t from-[#0b101b] to-transparent"></div>
        
        <div class="absolute bottom-0 left-0 p-6 md:p-12 w-full">
            <span id="txt-badge" class="inline-block px-3 py-1 mb-2 text-xs font-bold text-black bg-[#d4af37] rounded uppercase">Update Archive</span>
            <h1 id="txt-title" class="text-4xl md:text-6xl font-bold text-white drop-shadow-lg mb-4 viking-font">Patch Notes</h1>
            
            <div class="relative inline-block w-full md:w-auto">
                <select id="version-select" onchange="changeVersion(this.value)" class="appearance-none bg-black/60 border border-[#d4af37] text-white py-3 px-6 pr-12 rounded text-lg focus:outline-none cursor-pointer w-full md:w-auto backdrop-blur-sm">
                    <option>Loading...</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#d4af37]">
                    <span class="material-symbols-outlined notranslate">expand_more</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 -mt-10 relative z-10">
        
        <div class="glass-panel rounded-xl p-6 mb-8 border border-gray-700 flex flex-col md:flex-row items-center justify-between gap-4 shadow-xl">
            <div class="flex items-center gap-4">
                <span class="material-symbols-outlined text-4xl gold-text notranslate">update</span>
                <div>
                    <h2 class="text-lg font-bold text-white"><span id="txt-utc">Release (UTC)</span></h2>
                    <p id="utc-time-display" class="text-sm text-gray-400">--</p>
                </div>
            </div>
            <div id="maintenance-timer" class="text-center md:text-right bg-black/30 p-3 rounded-lg border border-gray-700">
                <p class="text-xs text-gray-400 uppercase tracking-widest mb-1" id="txt-local">Start Time (Local)</p>
                <p id="local-time-display" class="text-xl font-mono text-[#d4af37] font-bold">--:--</p>
            </div>
        </div>

        <div id="filter-buttons" class="flex gap-2 bg-[#1e293b] p-1 rounded-lg border border-gray-700 w-fit mb-6">
            <button id="btn-all" onclick="filterContent('all')" class="px-4 py-2 rounded-md text-sm font-bold bg-[#d4af37] text-black">All</button>
            <button id="btn-major" onclick="filterContent('major')" class="px-4 py-2 rounded-md text-sm font-bold text-gray-400">Highlights</button>
            <button id="btn-opt" onclick="filterContent('opt')" class="px-4 py-2 rounded-md text-sm font-bold text-gray-400">Details</button>
        </div>

        <div id="content-grid" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div id="major-updates-section" class="lg:col-span-2 space-y-8"></div>

            <div id="details-section" class="lg:col-span-1 space-y-6">
                <div class="glass-panel p-5 rounded-xl border border-gray-700">
                    <h3 class="text-xl font-bold text-[#d4af37] mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined notranslate">radio_button_unchecked</span> <span id="txt-cat-new">New</span>
                    </h3>
                    <ul class="detail-list" id="list-new"></ul>
                </div>
                <div class="glass-panel p-5 rounded-xl border border-gray-700">
                    <h3 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined notranslate">tune</span> <span id="txt-cat-opt">Optimizations</span>
                    </h3>
                    <div id="opt-container" class="space-y-2"></div>
                </div>
                <div class="glass-panel p-5 rounded-xl border border-gray-700">
                    <h3 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2 viking-font">
                        <span class="material-symbols-outlined notranslate">pest_control</span> <span id="txt-cat-fix">Fixes</span>
                    </h3>
                    <ul class="detail-list" id="list-fixes"></ul>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-12 mb-4 text-gray-600 text-xs">Unofficial Patch Notes Page</div>
    </div>

    <script>
        // --- TRANSLATIONS ---
        const uiTranslations = {
            en: { back: "Back", home: "Home", badge: "Update Archive", title: "Patch Notes", utc: "Release (UTC)", local: "Your Time", all: "All", major: "Highlights", opt: "Details", cat_new: "New Features", cat_opt: "Optimizations", cat_fix: "Fixes" },
            de: { back: "Zurück", home: "Start", badge: "Update Archiv", title: "Patch Notes", utc: "Release (UTC)", local: "Deine Zeit", all: "Alle", major: "Highlights", opt: "Details", cat_new: "Neuheiten", cat_opt: "Optimierungen", cat_fix: "Fehlerbehebung" },
            cn: { back: "返回", home: "主页", badge: "更新存档", title: "更新说明", utc: "发布 (UTC)", local: "当地时间", all: "全部", major: "亮点", opt: "详情", cat_new: "新功能", cat_opt: "优化", cat_fix: "修复" },
            ru: { back: "Назад", home: "Главная", badge: "Архив обновлений", title: "Патчноуты", utc: "Релиз (UTC)", local: "Ваше время", all: "Все", major: "Главное", opt: "Детали", cat_new: "Новое", cat_opt: "Оптимизация", cat_fix: "Исправления" }
        };

        const urlParams = new URLSearchParams(window.location.search);
        let currentLang = urlParams.get('lang') || 'en';
        if (!['en','de','cn','ru'].includes(currentLang)) currentLang = 'en';
        let allPatchData = [];

        // --- CLOCK ---
        function startLiveClock() {
            setInterval(() => {
                document.getElementById('nav-clock').innerText = new Date().toLocaleTimeString(currentLang === 'cn' ? 'zh-CN' : currentLang);
            }, 1000);
        }

        // --- UI UPDATE ---
        function updateUI() {
            const t = uiTranslations[currentLang] || uiTranslations.en;
            document.getElementById('txt-back').innerText = t.back;
            document.getElementById('txt-home').innerText = t.home;
            document.getElementById('txt-badge').innerText = t.badge;
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-utc').innerText = t.utc;
            document.getElementById('txt-local').innerText = t.local;
            
            document.getElementById('btn-all').innerText = t.all;
            document.getElementById('btn-major').innerText = t.major;
            document.getElementById('btn-opt').innerText = t.opt;
            
            document.getElementById('txt-cat-new').innerText = t.cat_new;
            document.getElementById('txt-cat-opt').innerText = t.cat_opt;
            document.getElementById('txt-cat-fix').innerText = t.cat_fix;

            // Link Fix
            document.getElementById('nav-home-link').href = `index.html?lang=${currentLang}`;
            
            document.documentElement.lang = currentLang;
            ['en','de','cn','ru'].forEach(l => { 
                document.getElementById(`lang-${l}`).className = l === currentLang ? "lang-btn lang-active" : "lang-btn lang-inactive"; 
            });
        }

        // --- INIT & LOAD ---
        async function init() {
            startLiveClock();
            updateUI();
            try {
                const res = await fetch('patchnotes.json?v=' + Date.now());
                const rawData = await res.json();
                
                // FILTER: Echte Updates only
                allPatchData = rawData.filter(entry => entry.type !== 'news' && entry.meta);
                
                const sel = document.getElementById('version-select');
                sel.innerHTML = '';
                
                if (allPatchData.length === 0) {
                    const opt = document.createElement('option');
                    opt.text = "No Updates found";
                    sel.appendChild(opt);
                    return;
                }

                allPatchData.forEach((entry, idx) => {
                    const opt = document.createElement('option');
                    opt.value = idx;
                    opt.text = entry.meta[`title_${currentLang}`] || entry.meta.title_en;
                    sel.appendChild(opt);
                });
                
                loadUpdate(0);
            } catch(e) { console.error("Error loading json:", e); }
        }

        function changeVersion(index) { loadUpdate(index); }

        function loadUpdate(index) {
            const entry = allPatchData[index];
            if(!entry) return;

            const data = entry[currentLang] || entry['en'];
            const meta = entry.meta;
            const pData = data.data || data || {}; 

            // --- IMAGE LOGIC (WIE IM ALTEN CODE) ---
            if(meta.image_url && meta.image_url !== "") {
                document.getElementById('hero-img').src = meta.image_url;
            } else {
                document.getElementById('hero-img').src = 'header-bg.jpg';
            }

            // TIME CALCULATION
            document.getElementById('utc-time-display').innerText = meta.display_time || "--";
            if(meta.start_timestamp) {
                try {
                    const date = new Date(meta.start_timestamp);
                    const loc = (currentLang === 'cn') ? 'zh-CN' : currentLang;
                    const localStr = date.toLocaleDateString(loc, { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    // Offset
                    const offset = -(date.getTimezoneOffset() / 60);
                    const offsetStr = offset >= 0 ? `+${offset}` : offset;
                    document.getElementById('local-time-display').innerHTML = `${localStr} <span class="text-sm font-normal text-gray-500">(UTC${offsetStr})</span>`;
                } catch(e) { console.error(e); }
            } else {
                document.getElementById('local-time-display').innerText = "--:--";
            }
            
            // HIGHLIGHTS
            const majorSec = document.getElementById('major-updates-section');
            majorSec.innerHTML = '';
            if(pData.major && Array.isArray(pData.major)) {
                pData.major.forEach((m, i) => { majorSec.innerHTML += `<div class="glass-panel rounded-xl p-6 border border-gray-700"><h3 class="text-xl font-bold text-white mb-2 viking-font">Highlight #${i+1}</h3><p class="text-gray-300">${m}</p></div>`; });
            }

            // LISTS
            const fill = (id, list) => { 
                const el = document.getElementById(id);
                if(list && Array.isArray(list) && list.length > 0) {
                    el.innerHTML = list.map(i=>`<li>${i}</li>`).join('');
                } else {
                    el.innerHTML = '<li class="italic text-gray-600">None</li>';
                }
            }
            fill('list-new', pData.new_features);
            fill('list-fixes', pData.fixes);
            
            // OPTIMIZATIONS (DROPDOWNS)
            const optCont = document.getElementById('opt-container');
            optCont.innerHTML = '';
            if(pData.optimizations && Array.isArray(pData.optimizations)) {
                pData.optimizations.forEach(o => { 
                    optCont.innerHTML += `
                    <details class="group">
                        <summary>${o.title} <span class="material-symbols-outlined notranslate text-sm transition-transform group-open:rotate-180">expand_more</span></summary>
                        <div class="dropdown-content mt-2 text-sm text-gray-300 pl-4">
                            <ul class="detail-list">${o.items.map(i=>`<li>${i}</li>`).join('')}</ul>
                        </div>
                    </details>`; 
                });
            } else {
                optCont.innerHTML = '<p class="italic text-gray-600 pl-4">None</p>';
            }
        }
        
        // --- LAYOUT FILTER (WIEDERHERGESTELLT) ---
        function filterContent(type) {
             const left = document.getElementById('major-updates-section');
             const right = document.getElementById('details-section');
             const grid = document.getElementById('content-grid');
             
             // Buttons
             ['all', 'major', 'opt'].forEach(b => { 
                 const el = document.getElementById(`btn-${b}`);
                 if(b===type) { el.classList.remove('text-gray-400'); el.classList.add('bg-[#d4af37]', 'text-black'); }
                 else { el.classList.add('text-gray-400'); el.classList.remove('bg-[#d4af37]', 'text-black'); }
             });

             // Logic
             if(type==='all') { 
                 left.style.display = 'block'; right.style.display = 'block'; 
                 grid.classList.add('lg:grid-cols-3'); grid.classList.remove('grid-cols-1');
                 left.className = 'lg:col-span-2 space-y-8';
                 right.className = 'lg:col-span-1 space-y-6';
             }
             else if(type==='major') { 
                 left.style.display = 'block'; right.style.display = 'none'; 
                 grid.classList.remove('lg:grid-cols-3'); grid.classList.add('grid-cols-1');
                 left.className = 'space-y-8 mx-auto max-w-3xl'; // Schön zentriert
             }
             else if(type==='opt') { 
                 left.style.display = 'none'; right.style.display = 'block'; 
                 grid.classList.remove('lg:grid-cols-3'); grid.classList.add('grid-cols-1');
                 right.className = 'space-y-6 mx-auto max-w-2xl'; // Schön zentriert
             }
        }
        
        init();
    </script>
</body>
</html>
